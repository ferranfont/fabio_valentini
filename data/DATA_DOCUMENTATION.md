# Data Files Documentation

## Overview
This folder contains futures market data for NQ (Nasdaq-100 E-mini) and ES (E-mini S&P 500) at different timeframes and formats. The primary focus is on NQ tick data for absorption analysis.

---

## ðŸ“Š Data Files

### Current NQ Data (Primary)

#### 1. **time_and_sales_nq.csv**
**Instrument:** NQ (Nasdaq-100 E-mini futures)
**Timeframe:** Tick data (every trade)
**Date Coverage:** October 9-10, 2025 (2 days)
**Records:** ~448,332 ticks
**Format:** European (`;` separator, `,` decimal)

**Columns:**
- `Timestamp` - Date and time (Madrid time CET/CEST)
- `Precio` - Trade price
- `Volumen` - Volume (contracts)
- `Lado` - Side (BID/ASK)
- `Bid` - Best bid price
- `Ask` - Best ask price

**Sample Data:**
```
Timestamp;Precio;Volumen;Lado;Bid;Ask
2025-10-09 06:00:20.592;25327,5;1;ASK;25327,25;25327,5
2025-10-09 06:00:21.183;25327,25;2;BID;25327,25;25327,5
```

**Usage:**
- Input for `stat_quant/find_absortion_vol_efford.py`
- Generates absorption signals

**Characteristics:**
- **Tick Size:** 0.25 points
- **Point Value:** $20
- **Timezone:** Madrid (CET/CEST)
- **Market Hours:** 6:00 - 16:00 local time

---

#### 2. **time_and_sales_absorption_NQ.csv**
**Instrument:** NQ (Nasdaq-100 E-mini futures)
**Timeframe:** 5-second resampled data
**Date Coverage:** October 9-10, 2025
**Records:** ~103,527 (after resampling from 448K ticks)
**Format:** European (`;` separator, `,` decimal)

**Columns (Original + Absorption):**
- `Timestamp` - Date and time
- `Precio` - Price
- `Volumen` - Volume
- `Lado` - Side (BID/ASK)
- `Bid` - Best bid
- `Ask` - Best ask
- **`bid_abs`** - BID absorption detected (True/False)
- **`ask_abs`** - ASK absorption detected (True/False)
- **`bid_vol`** - Abnormal BID volume (True/False)
- **`ask_vol`** - Abnormal ASK volume (True/False)
- **`vol_zscore`** - Statistical z-score of volume
- **`price_move_ticks`** - Actual price movement after signal

**Generated By:** `stat_quant/find_absortion_vol_efford.py`

**Usage:**
- Input for `plot_real_time_streamlit.py` (real-time visualization)
- Input for `plot_absortion_chart.py` (static chart)
- Input for `strat/strat_fabio_ATR.py` (backtesting)

**Statistics:**
- BID absorption events: ~1,263 (1.22%)
- ASK absorption events: ~1,492 (1.44%)
- Total absorption events: ~2,755 (2.66%)

---

#### 3. **time_and_sales_absorption_ES.csv**
**Instrument:** ES (E-mini S&P 500 futures)
**Status:** Optional/Legacy
**Format:** Same structure as NQ version
**Usage:** Switch `SYMBOL = 'ES'` in scripts to use ES data

---

### Legacy ES Data

#### 4. **ES_near_tick_data_27_jul_2025.csv**
**Timeframe:** Tick data (every trade)
**Date Coverage:** July 25, 2025 (single day)
**Records:** ~547,019 ticks
**Format:** European (`;` separator, `,` decimal)

**Columns:**
- `datetime` - Date and time (format: `DD/MM/YYYY HH:MM`)
- `open` - Opening price
- `high` - Highest price
- `low` - Lowest price
- `close` - Closing price
- `volume` - Volume traded

**Usage:** Processed by `utils/clean_data_and_format_tick_data.py`
- Converts European format to standard
- Resamples tick data â†’ daily candles (1D)

**Sample Data:**
```
25/07/2025 0:00;6406,75;6406,75;6406,75;6406,75;30
25/07/2025 0:00;6406,75;6406,75;6406,75;6406,75;4
```

---

#### 5. **es_1min_data_2015_2025.csv**
**Timeframe:** 1-minute candles
**Date Coverage:** January 2015 - 2025 (10+ years)
**Records:** ~3,560,671 minutes
**Format:** Standard CSV (`,` separator, `.` decimal)

**Columns:**
- `date` - Timestamp with UTC timezone
- `open` - Opening price
- `high` - Highest price
- `low` - Lowest price
- `close` - Closing price
- `volume` - Volume traded
- `dow` - Day of week
- `long_level` - Long entry level
- `short_level` - Short entry level
- `long_stop` - Long stop loss
- `short_stop` - Short stop loss

**Usage:**
- Processed by `utils/clean_data_minut_format_all_dataframe.py` (resamples to daily)
- Source for `utils/clean_data_one_day_data.py` (extracts single days)

**Sample Data:**
```
2015-01-02 00:00:00+00:00,2483.5,2483.5,2483.25,2483.5,160,friday,2484.1,2482.9,2479.75,2487.25
```

---

#### 6. **es_1min_data_2023_03_01.csv**
**Timeframe:** 1-minute candles
**Date Coverage:** March 1, 2023 (single day)
**Records:** ~1,381 minutes
**Format:** Standard CSV (`,` separator, `.` decimal)

**Columns:** (Same as `es_1min_data_2015_2025.csv`)

**Usage:** Generated by `utils/clean_data_one_day_data.py`
- Extracted from the full dataset
- Used for single-day minute-level analysis
- Target date configurable via `TARGET_DATE` variable

**Sample Data:**
```
2023-03-01 00:00:00+00:00,4455.0,4456.25,4455.0,4455.75,234,wednesday,4468.3,4441.7,4371.88,4538.12
```

---

---

## ðŸ”„ Processing Scripts

### NQ Data Processing (Current Focus)

| Script | Input File | Output | Purpose |
|--------|-----------|--------|---------|
| `stat_quant/find_absortion_vol_efford.py` | `time_and_sales_nq.csv` | `time_and_sales_absorption_NQ.csv` | Detect absorption signals |
| `plot_real_time_streamlit.py` | `time_and_sales_absorption_NQ.csv` | Interactive web app | Real-time tick replay |
| `plot_absortion_chart.py` | `time_and_sales_absorption_NQ.csv` | Static HTML chart | Absorption visualization |
| `strat/strat_fabio_ATR.py` | `time_and_sales_absorption_NQ.csv` | `outputs/tracking_record.csv` | Backtest strategy |

### ES Data Processing (Legacy)

| Script | Input File | Output | Purpose |
|--------|-----------|--------|---------|
| `utils/clean_data_and_format_tick_data.py` | `ES_near_tick_data_27_jul_2025.csv` | Daily chart | Tick â†’ Daily resampling |
| `utils/clean_data_minut_format_all_dataframe.py` | `es_1min_data_2015_2025.csv` | Daily chart | Minutes â†’ Daily resampling |
| `utils/clean_data_one_day_data.py` | `es_1min_data_2015_2025.csv` | Single day CSV + chart | Extract specific day |

---

## ðŸ“ˆ Data Hierarchy

### NQ Pipeline (Primary)
```
Raw Tick Data (time_and_sales_nq.csv)
    â†“ absorption detection (5-sec resample)
Absorption Data (time_and_sales_absorption_NQ.csv)
    â†“ visualization / backtesting
Charts & Trade Results
```

### ES Pipeline (Legacy)
```
Tick Data (highest resolution)
    â†“ resample
1-Minute Data
    â†“ resample / extract
Daily Data / Single Day Data
```

---

## ðŸ’¡ Notes

### NQ Data (Current Focus)
- Timestamps are in **Madrid time (CET/CEST)**
- Price data represents NQ (Nasdaq-100 E-mini) futures contracts
- Tick size: **0.25 points**
- Point value: **$20 per point**
- Volume represents number of contracts traded
- Format: **European CSV** (`;` separator, `,` decimal)

### ES Data (Legacy)
- Timestamps are in **UTC timezone** (for 1-min data)
- Price data represents ES (E-mini S&P 500) futures contracts
- Volume represents number of contracts traded
- Trading levels (long/short) included for strategy reference

---

## ðŸ“Š Plotting Functions

### Differences between `plot_chart_volume.py` vs `plot_minute_data.py`

| Feature | `plot_chart_volume.py` | `plot_minute_data.py` |
|---------|------------------------|------------------------|
| **Chart Type** | Line chart (close prices) | **Candlestick chart** (OHLC) |
| **X-axis Format** | `"%b %d<br>%Y"` (e.g., "Jan 15<br>2023") | `"%H:%M"` (e.g., "14:30") |
| **X-axis Ticks** | Automatic | Every hour (`dtick=3600000`) |
| **Use Case** | Daily/Weekly/Monthly data | **Intraday minute data** |
| **Price Display** | Single line (close only) | Full candles (open/high/low/close) |
| **Candle Colors** | N/A | Green (up) / Red (down) with black borders |
| **Background** | Light grey | White |
| **Grid Style** | Default | More transparent |
| **Range Slider** | Default | Hidden |

### Visual Summary

- **`plot_chart_volume.py`**: Simple line + volume (for long-term daily trends)
- **`plot_minute_data.py`**: Candlestick + volume with hourly time labels (for intraday analysis)

### Function Usage

```python
# For daily/long-term data
from plot_chart_volume import plot_close_and_volume
plot_close_and_volume(symbol, timeframe, df_daily)

# For minute/intraday data
from plot_minute_data import plot_minute_data
plot_minute_data(symbol, timeframe, df_minute)
```